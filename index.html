<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Jones Bar WX Public Data</title>
  </head>

  <body>
    <header>
      <h1>Jones Bar WX Public Data</h1>
      <p>
        Static downloads generated on a schedule from a private database.
      </p>
    </header>

    <main>
      <section aria-labelledby="downloads">
        <h2 id="downloads">Downloads</h2>
        <ul>
          <li>
            <a href="data/outdoor_conditions.json">outdoor_conditions.json</a>
            <span> (machine-friendly)</span>
          </li>
          <li>
            <a href="data/outdoor_conditions.csv">outdoor_conditions.csv</a>
            <span> (spreadsheet-friendly)</span>
          </li>
        </ul>
      </section>

      <section aria-labelledby="status-title">
        <h2 id="status-title">Status</h2>
        <div id="status" role="status" aria-live="polite">
          <p><strong>File generated:</strong> <span id="gen">Loading…</span></p>
          <p><strong>Newest data:</strong> <span id="latest">Loading…</span></p>
        </div>
        <p>
          <small>
            Tip: These timestamps are shown in UTC with a local time conversion in parentheses.
          </small>
        </p>
      </section>

      <hr>

      <section aria-labelledby="about">
        <h2 id="about">About this data</h2>
        <p>
          The data published here comes from a personal Davis weather station located at Jones Bar in
          Nevada County, California.
        </p>
        <ul>
          <li><strong>Source:</strong> Davis WeatherLink API</li>
          <li><strong>Collection interval:</strong> approximately every 15 minutes</li>
          <li><strong>Published window:</strong> most recent 7 days</li>
          <li><strong>Public access:</strong> static files only (no direct database access)</li>
        </ul>

        <details>
          <summary><strong>Project notes (why + design goals)</strong></summary>

          <h3>Why</h3>
          <p>
            This project was built to explore reliable, low-maintenance data publishing for environmental
            observations. The focus was not on visualization, but on creating a predictable, inspectable
            data pipeline that mirrors how monitoring systems behave in production environments.
          </p>

          <h3>Design goals</h3>
          <ul>
            <li>Clear separation between private ingestion/storage and public outputs</li>
            <li>Deterministic update schedules with visible timestamps</li>
            <li>Formats suitable for downstream tools (scripts, Tableau, integrations)</li>
            <li>Static delivery to reduce attack surface and operational complexity</li>
          </ul>

          <p>
            <strong>
              The current implementation is intentionally simple and observable, with future iterations
              planned around validation, versioning, and expanded data products.
            </strong>
          </p>
        </details>

        <details>
          <summary><strong>Published formats</strong></summary>
          <ul>
            <li><strong>JSON:</strong> machine-readable format suitable for APIs, scripts, and Tableau Web Data Connectors</li>
            <li><strong>CSV:</strong> spreadsheet-friendly format suitable for direct upload to Tableau Public</li>
          </ul>
        </details>
      </section>
    </main>

    <footer>
      <p><small>Jones Bar WX</small></p>
    </footer>

    <script>
      function normalizeUtc(iso) {
        if (!iso) return null;

        // If it already has timezone info (Z or ±hh:mm), leave it alone
        if (iso.endsWith("Z") || /[+-]\d\d:\d\d$/.test(iso)) return iso;

        // Otherwise assume it is UTC and append Z
        return iso + "Z";
      }

      function formatWithLocal(isoUtc) {
        if (!isoUtc) return "unavailable";

        const normalized = normalizeUtc(isoUtc);
        const d = new Date(normalized);
        if (isNaN(d.getTime())) return isoUtc + " UTC";

        const local = d.toLocaleString(undefined, {
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit"
        });

        return (normalized.endsWith("Z") ? normalized : isoUtc) + " UTC (" + local + " local)";
      }

      function setStatus(text) {
        document.getElementById("gen").textContent = text;
        document.getElementById("latest").textContent = text;
      }

      fetch("data/outdoor_conditions.json")
        .then(r => {
          if (!r.ok) throw new Error("HTTP " + r.status);
          return r.json();
        })
        .then(data => {
          document.getElementById("gen").textContent = formatWithLocal(data.generated_at_utc);
          document.getElementById("latest").textContent = formatWithLocal(data.latest_row_timestamp_utc);
        })
        .catch(() => {
          setStatus("Unable to load");
        });
    </script>
  </body>
</html>
