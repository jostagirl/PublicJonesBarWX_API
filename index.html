<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Jones Bar WX Public Data</title>
  </head>
  <body>
    <h1>Jones Bar WX Public Data</h1>
    <ul>
      <li><a href="data/outdoor_conditions.json">outdoor_conditions.json</a></li>
      <li><a href="data/outdoor_conditions.csv">outdoor_conditions.csv</a></li>
    </ul>
	<div class="meta" id="status">
  		Files generated at: loading…<br>
  		Newest data timestamp: loading…
	</div>
    <p>Generated by a private publisher on a schedule.</p>

<script>
  function normalizeUtc(iso) {
    if (!iso) return null;

    // If it already has timezone info (Z or Â±hh:mm), leave it alone
    if (iso.endsWith("Z") || /[+-]\d\d:\d\d$/.test(iso)) return iso;

    // Otherwise assume it is UTC and append Z
    return iso + "Z";
  }

  function formatWithLocal(isoUtc) {
    if (!isoUtc) return "unavailable";

    const normalized = normalizeUtc(isoUtc);
    const d = new Date(normalized);
    if (isNaN(d.getTime())) return isoUtc + " UTC";

    const local = d.toLocaleString(undefined, {
      year: "numeric",
      month: "2-digit",
      day: "2-digit",
      hour: "2-digit",
      minute: "2-digit",
      second: "2-digit"
    });

    return (normalized.endsWith("Z") ? normalized : isoUtc) + " UTC (" + local + " local)";
  }

  fetch("data/outdoor_conditions.json")
    .then(r => r.json())
    .then(data => {
      const gen = formatWithLocal(data.generated_at_utc);
      const latest = formatWithLocal(data.latest_row_timestamp_utc);

      document.getElementById("status").innerHTML =
        "File generated at: " + gen + "<br>" +
        "Newest data timestamp: " + latest;
    })
    .catch(() => {
      document.getElementById("status").textContent = "Status: unable to load";
    });
</script>

  </body>
</html>
